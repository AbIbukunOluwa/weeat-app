<%- include('../partials/header', { user: user, title: title }) %>

<div class="admin-dashboard">
  <div class="dashboard-header">
    <h1>ğŸ›¡ï¸ WeEat Administration Dashboard</h1>
    <div class="admin-info">
      <span class="admin-badge">Admin: <%= user.username %></span>
      <span class="timestamp">Last Login: <%= new Date().toLocaleString() %></span>
    </div>
  </div>
  
  <!-- Stats Overview -->
  <div class="stats-grid">
    <div class="stat-card users">
      <div class="stat-icon">ğŸ‘¥</div>
      <div class="stat-content">
        <h3>Total Users</h3>
        <p class="stat-number"><%= stats.totalUsers %></p>
        <span class="stat-change positive">â†‘ +12 this week</span>
      </div>
    </div>
    
    <div class="stat-card orders">
      <div class="stat-icon">ğŸ“¦</div>
      <div class="stat-content">
        <h3>Active Orders</h3>
        <p class="stat-number"><%= stats.totalOrders %></p>
        <span class="stat-change positive">â†— +5 today</span>
      </div>
    </div>
    
    <div class="stat-card complaints">
      <div class="stat-icon">ğŸ’¬</div>
      <div class="stat-content">
        <h3>Open Complaints</h3>
        <p class="stat-number"><%= stats.totalComplaints %></p>
        <span class="stat-change critical">âš  Needs attention</span>
      </div>
    </div>
    
    <div class="stat-card revenue">
      <div class="stat-icon">ğŸ’°</div>
      <div class="stat-content">
        <h3>Revenue (MTD)</h3>
        <p class="stat-number">$24,567</p>
        <span class="stat-change positive">â†‘ +18.5%</span>
      </div>
    </div>
  </div>

  <div class="tool-section">
    <h3>ğŸ—„ï¸ Database & User Management</h3>
    
    <!-- Enhanced User Search -->
    <div class="user-search-section">
      <h4>ğŸ‘¤ User Search & Management</h4>
      <form method="GET" action="/admin/users" class="advanced-search-form">
        <div class="search-grid">
          <div class="search-field">
            <label for="search">Search Users:</label>
            <input type="text" name="search" id="search" placeholder="Username or email..." 
                   value="<%= typeof search !== 'undefined' ? search : '' %>" class="search-input">
          </div>
          
          <div class="search-field">
            <label for="filter_role">Filter by Role:</label>
            <select name="filter_role" id="filter_role" class="search-select">
              <option value="">All Roles</option>
              <option value="customer">Customer</option>
              <option value="staff">Staff</option>
              <option value="admin">Admin</option>
            </select>
          </div>
          
          <div class="search-field">
            <label for="sort">Sort by:</label>
            <select name="sort" id="sort" class="search-select">
              <option value="id">User ID</option>
              <option value="username">Username</option>
              <option value="email">Email</option>
              <option value="createdAt">Date Created</option>
            </select>
          </div>
          
          <div class="search-actions">
            <button type="submit" class="btn-search">ğŸ” Search Users</button>
            <button type="button" onclick="clearSearch()" class="btn-clear">Clear</button>
          </div>
        </div>
      </form>
    </div>
  
    <!-- Quick Actions -->
    <div class="admin-quick-actions">
      <button onclick="exportUsers()" class="action-btn">ğŸ“Š Export Users</button>
      <button onclick="generateReport()" class="action-btn">ğŸ“ˆ Generate Report</button>
      <button onclick="systemHealth()" class="action-btn">ğŸ”§ System Health</button>
    </div>
  </div>
  

<style>
  .user-search-section {
    background: #f8f9fa;
    padding: 25px;
    border-radius: 12px;
    margin: 20px 0;
    border: 1px solid #e9ecef;
  }
  
  .user-search-section h4 {
    color: var(--primary-red);
    margin: 0 0 20px 0;
    font-size: 1.2em;
  }
  
  .search-grid {
    display: grid;
    grid-template-columns: 2fr 1fr 1fr auto;
    gap: 15px;
    align-items: end;
  }
  
  .search-field {
    display: flex;
    flex-direction: column;
  }
  
  .search-field label {
    font-weight: 600;
    color: #333;
    margin-bottom: 5px;
    font-size: 14px;
  }
  
  .search-input, .search-select {
    padding: 10px 12px;
    border: 1px solid #ddd;
    border-radius: 6px;
    font-size: 14px;
    background: white;
    transition: border-color 0.2s;
  }
  
  .search-input:focus, .search-select:focus {
    outline: none;
    border-color: var(--accent-yellow);
    box-shadow: 0 0 0 2px rgba(247,127,0,0.1);
  }
  
  .search-actions {
    display: flex;
    flex-direction: column;
    gap: 8px;
  }
  
  .btn-search, .btn-clear {
    padding: 10px 16px;
    border: none;
    border-radius: 6px;
    font-size: 14px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s;
    white-space: nowrap;
  }
  
  .btn-search {
    background: var(--primary-red);
    color: white;
  }
  
  .btn-search:hover {
    background: #b91c1c;
  }
  
  .btn-clear {
    background: #6c757d;
    color: white;
  }
  
  .btn-clear:hover {
    background: #5a6268;
  }
  
  .admin-quick-actions {
    display: flex;
    gap: 15px;
    margin-top: 20px;
    flex-wrap: wrap;
  }
  
  .action-btn {
    padding: 12px 20px;
    background: var(--accent-yellow);
    color: white;
    border: none;
    border-radius: 8px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s;
  }
  
  .action-btn:hover {
    background: var(--primary-red);
    transform: translateY(-1px);
  }
  
  @media (max-width: 768px) {
    .search-grid {
      grid-template-columns: 1fr;
    }
    
    .search-actions {
      flex-direction: row;
    }
    
    .admin-quick-actions {
      flex-direction: column;
    }
  }
</style>


<script>
  function clearSearch() {
    document.getElementById('search').value = '';
    document.getElementById('filter_role').value = '';
    document.getElementById('sort').value = 'id';
  }
  
  function exportUsers() {
    window.location.href = '/admin/users/export?format=csv';
  }
  
  function generateReport() {
    const reportType = prompt('Report type (users/orders/complaints):') || 'users';
    window.location.href = `/admin/reports?report_type=${reportType}&date_range=30`;
  }
  
  function systemHealth() {
    fetch('/api/v1/system/status', {
      headers: {
        'X-API-Key': 'weeat-internal-2024',
        'User-Agent': 'WeEat-Monitor/1.0'
      }
    })
    .then(response => response.json())
    .then(data => {
      alert(`System Status: ${data.status}\nUptime: ${Math.floor(data.uptime/3600)} hours`);
    })
    .catch(err => {
      alert('System check failed. Check console for details.');
      console.error(err);
    });
  }
</script>
